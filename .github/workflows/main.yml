name: Build_IOS

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:
    runs-on: macos-13

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: stable

      - name: Install dependencies
        run: flutter pub get

      # üîπ Êñ∞Â¢ûÊ≠•È™§ÔºöË°•‰∏Å Podfile
      - name: Patch Podfile to relax Swift concurrency checks
        run: |
          cat << 'EOF' >> ios/Podfile

          post_install do |installer|
            installer.pods_project.targets.each do |target|
              target.build_configurations.each do |config|
                config.build_settings['SWIFT_STRICT_CONCURRENCY'] = 'complete'
                config.build_settings['OTHER_SWIFT_FLAGS'] ||= ['']
                config.build_settings['OTHER_SWIFT_FLAGS'] << '-Xfrontend' << '-disable-availability-checking'
              end
            end
          end
          EOF

      - name: Install CocoaPods
        run: |
          cd ios
          pod install --repo-update

      - name: Build iOS app
        run: flutter build ios --release --no-codesign
